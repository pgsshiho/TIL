# 트랜잭션
## 정의
더 이상 쪼갤 수 없는 최소 작업 단위
련의 작업이 모두 성공하거나 모두 실패하도록 보장하는 프로세스
DB조작(sql 실행 등)이 성공하면 커밋, 실패하면 롤배함
## 사용이유
여러 작업을 진행하다가 **문제가 생겼을 경우 이전 상태로 롤백하기 위해**
## 트랜잭션의 주요 특징(ACID)
1. 원자성(Atomicity)
- 이번 트랜잭션에 포함된 **모든 작업이 모두 수행되거나 모두 롤백됨**
- 실패 시 **트랜잭션 이전 상태로 복구**
2. 일관성 (Consistency)
- 트랜잭션 완료 후 **데이터는 항상 일관된 상태 유지**
- 모든 **비즈니스 규칙** 및 **무결성 제약 조건을 충족**
3. 독립성 (Isolation)
- 동시에 실행되는 **트랜잭션이 서로 간섭하지 않음**
- 트랜잭션 간 **중간 작업 상태를 보지 않도록 격리 수준 제공**
4. 지속성 (Durability)
- 트랜잭션 완료 후 **결과가 영구적으로 저장됨**
- 시스템 장애 시에도 **데이터 손실 없음**
## Spring 트랜잭션의 동작 방식
### 동기화
- 사용이유: 개발자가 여러개의 작업을 트랜잭션으로 관리하려면 **Connection 객체를 공유하는 등 불편함**
- 정의: 트랜잭션을 시작하기 위한 **Connection 객체를 특별한 저장소에 보관**해두고 **필요할 때 꺼내**쓸 수 있도록 하는 기술  
- 저장소는 작업 **thread마다 Connection 객체를 독립적으로 관리** -> multi thread충돌이 안남
### 추상화
애플리케이션에 각기술마다 **종속적인 코드를 이용하지 않고도 트랜잭션 사용가능**  
|애플리케이션|추상 인터페이스|
|----|----------------------------------------------------------|  
|Spring|PlatformTransactionManager|  
|JDBC|DataSourceTransactionManager|  
|JPA|JpaTransactionManager|  
|Hibernate|HibernateTransactionManager| 
|JTA|JtaTransactionManager|   
### AOP를 이용한 트랜잭션 분리
- 사용이유: 여러 책임(기능)을 가지지만 서로 성격을 주고 받는 것이 없어 **코드를 나눠야** 할때
- 정의: 해당 로직을 클래스 밖으로 빼내서 별도의 모듈로 만드는 AOP를 고안후 **트랜잭션 어노테이션 지원**(@Transactional)
- AOP란 : 비즈니스 로직과는 별도로 **공통적으로 적용되는 기능**을 분리
## 트랜잭션의 전파
- 정의: **트랜잭션 간 상호작용**, 메서드가 호출될 때 기존 트랜잭션 처리 방식을 결정  
| 옵션          | 설명                                                     |
|---------------|----------------------------------------------------------|
| REQUIRED      | 기존 트랜잭션에 참여. 없으면 새로 생성                   |
| REQUIRES_NEW  | 항상 새 트랜잭션 생성                                    |
| NESTED        | 부모 트랜잭션 내에서 중첩 트랜잭션 실행                  |
| MANDATORY     | 반드시 기존 트랜잭션이 있어야 실행. 없으면 예외          |
| NOT_SUPPORTED | 트랜잭션 없이 실행                                       |
| NEVER         | 트랜잭션이 있으면 예외 발생                              |
| SUPPORTS      | 트랜잭션이 있으면 참여, 없으면 비트랜잭션으로 실행       |

## 장점
- **추상화 제공**: JDBC,JPA 등 다양한 기술에 독립적인 방식 제공
- **비지니스 로직 분리**: 트랜잭션 코드와 비지니스 로직 분리
- **생산성 증가**: 선언적 방식으로 간단하게 트랜잭션 관리
- **데이터 안정성 보장**:실패 시 자동 롤백으로 데이터 무결성 유지
## 단점
- **초기 학습 부담**: 전파,격리 수준 등 복잡한 개념 학습 필요
- **AOP 기반 디버깅 어려움**: 프록시를 통한 동장이라 디버깅이 복잡
- **의존성 증가**: Spring 컨테이너의 종속적
- **오버헤드 발생**: AOP 및 트랜잭션 경계 처리로 인한 성능 비용 