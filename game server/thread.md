# 스레드
## 정의
- 프로세스처럼 명렁어를 **한 줄씩 실행**하는 기본 단위
## 프로세스와 스레드의 차이
- 스레드는 한 **프로세스안에 여러 개가 존재**
- 한 프로세스 안에 있는 스레드는 프로세스와 메모리 공간 공유
- **스레드마다 스택을** 가짐
- 한 함수의 지역 변수가 각 스레드마다 존재
- 프로세스는 회사라고 치면 스레드는 거기 직원
## 구성
### 싱글 스레드
하나의 프로세스와 하나의 스레드로 구성되는 프로그램 = 싱글 스레드 모델
### 메인스레드
- 기본으로 존재
- 대부분 여기서 프로그램을 실행 시킨다
- 여기서 실행하는 동안 다른 스레드들이 생김 이것을 멀티 스레드 혹은 멀티 스레딩이라고 부른다
### 문제
각 메모리나 인자 상태등이 달라 내가 원하는 함수가 먼저 실행이 되지않음 -> 오류발생
### 해결
각 스레드는 각각 호출 스택을 가짐
### 해결방안
- 프로젝트가 시작되면 스레드가 시작 끝나기전 다른것이 들어오면 기다림 상태로 바뀜
- 다른 것이 끝나면 다시 시작이됨
# 멀티 스레드
- 동시에 여러일을 한다
- 한꺼번에 여러일을 해서 좋아 보이지만 연산이 느려지기도함
## 사용해야할 상황
- 오래 걸리는 일 하나와 빨리 끝나는 일 여럿을 같이 해야할때
- 어떤 긴 처리를 진행하는 동안 다른 짧은 일을 처리해야 할 때
- 기기에 있는 CPU를 모두 활용해야 할 때
## 오래걸리는 거와 빨리 끝나는 일을 함께 해야할때
**게임 로딩**을 생각을 해보면 게임에 따라 다르지만 보통은 게임 로딩은 느리다.  
하지만 게임 로딩중에 아무것도 보여주지 않는다면 그건 유저 친화적이지 않다  
그래서 보통은 그래프를 보여주거나 미니 게임등을 넣어둔다 하지만 이것을 **싱글 스레드**를 한다면  
두가지일을 번갈아 가며 하기에 **더 오래걸리고 성능또한 저하가 된다. 게다가 코드까지 더러워 진다**  
하지만 멀티스레드를 이용한다면 두가지 일을 한번에 해 이런일을 방지 가능 하다.
```C#
LoadScene()
{
    Render();
    LoadScene();
    Render();
    LoadScene();
    //반복
}
```
```C#
bool isStillLoading;

Thread1
{
    isStillLoading = ture;
    while (isStillLoading){
        FrameMove();
        Render();
    }
}
Thread2{
    LoadScene();
    LoadModel();
    //등등
    isStillLoading = false;
}
```
## 긴 처리중 다른 짧은 일을 해야할때
예를 들어 플레이어 정보를 읽거나 쓸려고 할때 디스크를 사용하는데 이때 CPU는 놀고있으니 이때 **다른 사용자에게 분배**함
## 기기에 있는 CPU를 모두 활용해야 할때
**한개의 스레드는 오로지 한개의 코어만을 사용**함 그러니 8코어든 16코어든 싱글 스레드를 사용하면 오로지 한개의 코어를 사용해 1/8,1/16 의 성능 밖에 나오지 못함 소수 찾기로 예를 들면 현재 CPU1,2,3,4가 있는데 CPU1에서 다찾고 있는 셈  
그렇다면 아예 1에겐 0~25만,2에겐 25만 ~ 50만 이런식으로 한다면 싱글보단 빠르지만 결국 4번이 가장 늦게 끝남  
그렇다면 아예 애초부터 나누지말고 하나가 끝나면 하나를 나눠주는 식으로 할까? 그것도 오류가 난다 이것을 알기 위해선 **스레드의 정체**를 알아야 한다
## 스레드 너의 정체는 무엇이냐
사람은 두가지일을 할때 하나를 끝내고 나머지 하나를 한다 하지만 우리 컴퓨터는 똥멍청이기에 두가지일을 계속 왔다 갔다 하면서 두가지 일을 한다 이러한 것을 **컨텍스트 스위치** 라고 한다.  
근데 문제는 컴퓨터가 이 **컨텍스트 스위치를 할때 적지 않은 양의 연산**을 한다. 실행 중이던 스레드의 상태를 저장하고 스레드를 고르고 상태를 복원하고 실행하던 지점으로 강제이동하고 등등 많은 연산을 하니  컨텍스트 스위치를 최대한 덜 하면 되지않나 싶지만 그것도 아니다  
로딩이라고 생각을 할때 만약 애니메이션이 나오는데 만약 컨텍스트 스위치를 하는데 걸리는 시간이 1초라면 애니메이션은 1초에 한 번 씩밖에 보지못한다.  
그래서 기본적으로 **사람 입장에서 쾌적할 수 있는** 가급적 긴 시간 단위로 이루어 진다 이러한 시간 단위를 **타임 슬라이스** 라고 한다  
운영체제나 환경에 다르지만 보통 걸리는 시간은 **5밀리초** 사람 입장에선 갑갑하진 않지만 CPU는 5억* 5밀리초 대략 **250만개**의 명령어를 처리할수 있는 시간이니 넉넉하다.  
근데 만약 스레드가 2개 CPU가 2개면? 컨텍스트 스위치를 할 필요가 없다. **CPU>=스레드** 상태면 컨텍스트 스위치를 할 필요가 없다 CPU=집 스레드=비둘기 라 생각하면 편하다 만약 집이 비둘기보다 적으면